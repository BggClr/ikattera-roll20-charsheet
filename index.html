<div class="row">
	<div class="col">
		<div class="input-group mb-3">
			<span class="input-group-text">Уровень</span>
			<input type="number" name="attr_level" class="form-control" id="form_level" />
		</div>
		<div class="input-group mb-3">
			<span class="input-group-text">Раса</span>
			<select name="attr_race" id="form_race" class="form-select" aria-label="Раса">
				<option value=""></option>
				<option value="akir">Акир</option>
				<option value="gagan">Гаган</option>
				<option value="cro">Кро</option>
				<option value="paru">Пару</option>
				<option value="revera">Ревера-Нгахера</option>
				<option value="skepsi">Скепси</option>
			</select>
		</div>
		<div class="input-group mb-3 js-group-kind">
			<span class="input-group-text">Вид</span>
			<select name="attr_kind" id="form_kind" class="form-select" aria-label="Вид">
				<option value=""></option>
				<option value="hedgehog">Ёж</option>
				<option value="rodent">Грызун</option>
				<option value="hare">Заяц</option>
				<option value="cat">Кошка</option>
				<option value="mole">Крот</option>
				<option value="marten">Куница</option>
				<option value="lemur">Лемур</option>
				<option value="opossum">Опоссум</option>
				<option value="raptur">Раптур</option>
			</select>
		</div>
		<div class="input-group mb-3">
			<span class="input-group-text">Класс</span>
			<select name="attr_class" id="form_class" class="form-select" aria-label="Класс">
				<option value=""></option>
				<option value="bard">Бард</option>
				<option value="warior">Воин</option>
				<option value="bowman">Лучник</option>
				<option value="mage">Маг</option>
				<option value="chakram">Мастер чакрам</option>
				<option value="rogue">Разбойник</option>
				<option value="scientist">Ученый</option>
			</select>
		</div>
		<div class="input-group mb-3 js-group-subclass">
			<span class="input-group-text">Подкласс</span>
			<select name="attr_subclass" id="form_subclass" class="form-select" aria-label="Подкласс"/>
		</div>
	</div>
	<div class="col">
		<div class="input-group mb-3">
			<span class="input-group-text">Сила</span>
			<input type="number" name="attr_strength" class="form-control" id="form_strength" />
			<input type="number" name="attr_strength_mod" class="form-control" id="form_strength_mod" />
			<button type="button" class='js-roll roll btn btn-outline-primary' data-attr="strength"/>
			<button type="button" class='js-roll-adv roll btn btn-outline-success' data-attr="strength"/>
			<button type="button" class='js-roll-dis roll btn btn-outline-danger' data-attr="strength"/>
		</div>
		<div class="input-group mb-3">
			<span class="input-group-text">Ловкость</span>
			<input type="number" name="attr_dexterity" class="form-control" id="form_dexterity" />
			<input type="number" name="attr_dexterity_mod" class="form-control" id="form_dexterity_mod" />
			<button type="button" class='js-roll roll btn btn-outline-primary' data-attr="dexterity"/>
			<button type="button" class='js-roll-adv roll btn btn-outline-success' data-attr="dexterity"/>
			<button type="button" class='js-roll-dis roll btn btn-outline-danger' data-attr="dexterity"/>
		</div>
		<div class="input-group mb-3">
			<span class="input-group-text">Харизма</span>
			<input type="number" name="attr_charisma" class="form-control" id="form_charisma" />
			<input type="number" name="attr_charisma_mod" class="form-control" id="form_charisma_mod" />
			<button type="button" class='js-roll roll btn btn-outline-primary' data-attr="charisma"/>
			<button type="button" class='js-roll-adv roll btn btn-outline-success' data-attr="charisma"/>
			<button type="button" class='js-roll-dis roll btn btn-outline-danger' data-attr="charisma"/>
		</div>
		<div class="input-group mb-3">
			<span class="input-group-text">Мудрость</span>
			<input type="number" name="attr_wisdom" class="form-control" id="form_wisdom" />
			<input type="number" name="attr_wisdom_mod" class="form-control" id="form_wisdom_mod" />
			<button type="button" class='js-roll roll btn btn-outline-primary' data-attr="wisdom"/>
			<button type="button" class='js-roll-adv roll btn btn-outline-success' data-attr="wisdom"/>
			<button type="button" class='js-roll-dis roll btn btn-outline-danger' data-attr="wisdom"/>
		</div>
		<div class="input-group mb-3">
			<span class="input-group-text">Внимание</span>
			<input type="number" name="attr_attention" class="form-control" id="form_attention" />
			<input type="number" name="attr_attention_mod" class="form-control" id="form_attention_mod" />
			<button type="button" class='js-roll roll btn btn-outline-primary' data-attr="attention"/>
			<button type="button" class='js-roll-adv roll btn btn-outline-success' data-attr="attention"/>
			<button type="button" class='js-roll-dis roll btn btn-outline-danger' data-attr="attention"/>
		</div>
		<div class="input-group mb-3">
			<span class="input-group-text">Телосложение</span>
			<input type="number" name="attr_body" class="form-control" id="form_body" />
			<input type="number" name="attr_body_mod" class="form-control" id="form_body_mod" />
			<button type="button" class='js-roll roll btn btn-outline-primary' data-attr="body"/>
			<button type="button" class='js-roll-adv roll btn btn-outline-success' data-attr="body"/>
			<button type="button" class='js-roll-dis roll btn btn-outline-danger' data-attr="body"/>
		</div>
	</div>
	<div class="col"/>
</div>

<script type="text/worker">
	async function rollDice(dice, attributeName) {
		const roll = `&{template:default} {{name=@{character_name}}} {{result=[[${dice} + @{${attributeName}} + @{${attributeName}_mod}]]}}`;
		const results = await startRoll(roll);
		finishRoll(results.rollId);
	}

	on('sheet:opened', async function () {
		getAttrs(['race', 'level'], function(values) {
			if (values.race != 'revera') {
				setAttrs({
					kind: ''
				});
				$20('.js-group-kind').addClass('hidden');
			}
			if (values.level < 3) {
				setAttrs({
					subclass: 'none'
				});
				$20('.js-group-subclass').addClass('disabled');
			}
		});
		$20('.js-roll').addClass('btn').addClass('btn-outline-primary');
		populateListOptions({
			elemSelector: '#form_subclass',
			optionsArray: [
				{label: 'Выберите подкласс', value: 'none'},
				{label: 'Следопыт', value: 'bowman-pathfinder'},
				{label: 'Стрелок Эгмы', value: 'bowman-mage'},
				{label: 'Стремительность', value: 'bowman-swiftness'}
			]
		});
		const response = await fetch('https://raw.githubusercontent.com/LearnWebCode/json-example/master/animals-1.json');
		const data = await response.json();
		console.log(data);
	});

	on('change:race', function () {
		getAttrs(['race'], function(values) {
			if (values.race != 'revera') {
				setAttrs({
					kind: ''
				});
				$20('.js-group-kind').addClass('hidden');
			} else {
				$20('.js-group-kind').removeClass('hidden');
			}
		});
	});
	on('change:level', function () {
		getAttrs(['level'], function(values) {
			if (values.level < 3) {
				setAttrs({
					subclass: 'none'
				});
				$20('.js-group-subclass').addClass('disabled');
			} else {
				$20('.js-group-subclass').removeClass('disabled');
			}
		});
	});

	$20('button.js-roll').on('click', async e => {
		await rollDice('2d10', e.htmlAttributes['data-attr']);
	});
	$20('button.js-roll-adv').on('click', async e => {
		await rollDice('3d10kh2', e.htmlAttributes['data-attr']);
	});
	$20('button.js-roll-dis').on('click', async e => {
		await rollDice('3d10kl2', e.htmlAttributes['data-attr']);
	});
</script>
